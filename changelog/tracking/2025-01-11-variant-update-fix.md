# Fix Variant Update Error - 2025-01-11

## V·∫•n ƒë·ªÅ

- L·ªói khi c·∫≠p nh·∫≠t variant: `PUT /api/variants/variants/xanh-64gb 500`
- Error: `Malformed ObjectID: provided hex string representation must be exactly 12 bytes, instead got: "xanh-64gb", length 9`
- X·∫£y ra khi c·∫≠p nh·∫≠t t·ªìn kho v√† s·∫Øp x·∫øp h√¨nh ·∫£nh variant

## Nguy√™n nh√¢n

1. **ExpandableVariant.tsx**: S·ª≠ d·ª•ng `variant.databaseId || variant.id` l√†m variantId
2. **AddProductModalNew.tsx**: Khi t·∫°o variant object cho ExpandableVariant:
   - `id` ƒë∆∞·ª£c set th√†nh `"xanh-64gb"` (t·ª´ attributes)
   - `databaseId` kh√¥ng ƒë∆∞·ª£c set ƒë√∫ng ho·∫∑c b·ªã m·∫•t
3. **API call**: G·ª≠i `"xanh-64gb"` thay v√¨ ObjectID th·ª±c s·ª± ƒë·∫øn `/api/variants/variants/[id]`

## Gi·∫£i ph√°p

### 1. ‚úÖ S·ª≠a ExpandableVariant.tsx

- **File**: `src/app/components/admin/product-variant/ExpandableVariant.tsx`
- **Thay ƒë·ªïi**:
  - Ch·ªâ s·ª≠ d·ª•ng `variant.databaseId` (kh√¥ng fallback v·ªÅ `variant.id`)
  - Validate ObjectID format tr∆∞·ªõc khi g·ªçi API
  - Th√™m error handling v√† logging chi ti·∫øt
  - Hi·ªÉn th·ªã th√¥ng b√°o l·ªói r√µ r√†ng cho user

### 2. ‚úÖ S·ª≠a AddProductModalNew.tsx

- **File**: `src/app/(admin)/admin/manage-products/AddProductModalNew.tsx`
- **Thay ƒë·ªïi**:
  - Th√™m `databaseId: variation.id` khi convert variation sang variant format
  - Validate ObjectID format tr∆∞·ªõc khi set databaseId
  - Th√™m logging ƒë·ªÉ debug

## Code Changes

### ExpandableVariant.tsx

```typescript
// Tr∆∞·ªõc
const variantId = variant.databaseId || variant.id;

// Sau
const variantId = variant.databaseId;
if (!variantId) {
  setErrors(['Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t: Bi·∫øn th·ªÉ n√†y ch∆∞a ƒë∆∞·ª£c l∆∞u v√†o database']);
  return;
}

// Validate ObjectID format
const objectIdRegex = /^[0-9a-fA-F]{24}$/;
if (!objectIdRegex.test(variantId)) {
  setErrors(['Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t: ID bi·∫øn th·ªÉ kh√¥ng h·ª£p l·ªá']);
  return;
}
```

### AddProductModalNew.tsx

```typescript
// Th√™m validation cho databaseId
const objectIdRegex = /^[0-9a-fA-F]{24}$/;
const databaseId = variation.id && objectIdRegex.test(variation.id) ? variation.id : undefined;

const variant = {
  id: displayId,
  databaseId: databaseId // Ch·ªâ set n·∫øu l√† ObjectID h·ª£p l·ªá
  // ... other fields
};
```

## Test Cases

### ‚úÖ Test 1: Variant ƒë√£ t·ªìn t·∫°i trong database

- Load product c√≥ variants t·ª´ database
- Edit variant (c·∫≠p nh·∫≠t stock, s·∫Øp x·∫øp images)
- K·∫øt qu·∫£: API call v·ªõi ObjectID h·ª£p l·ªá

### ‚úÖ Test 2: Variant m·ªõi ch∆∞a l∆∞u

- T·∫°o variant m·ªõi t·ª´ attributes
- Th·ª≠ edit variant
- K·∫øt qu·∫£: Hi·ªÉn th·ªã th√¥ng b√°o "ch∆∞a ƒë∆∞·ª£c l∆∞u v√†o database"

### ‚úÖ Test 3: Invalid ObjectID

- Variant c√≥ id kh√¥ng ph·∫£i ObjectID format
- Th·ª≠ edit variant
- K·∫øt qu·∫£: Hi·ªÉn th·ªã th√¥ng b√°o "ID bi·∫øn th·ªÉ kh√¥ng h·ª£p l·ªá"

## Validation Rules

### ObjectID Format

- Ph·∫£i l√† string 24 k√Ω t·ª±
- Ch·ªâ ch·ª©a k√Ω t·ª± hex (0-9, a-f, A-F)
- Regex: `/^[0-9a-fA-F]{24}$/`

### Error Handling

- Ki·ªÉm tra `databaseId` t·ªìn t·∫°i
- Validate ObjectID format
- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói r√µ r√†ng
- Log chi ti·∫øt ƒë·ªÉ debug

## K·∫øt qu·∫£

- ‚úÖ S·ª≠a l·ªói "Malformed ObjectID"
- ‚úÖ C·∫£i thi·ªán error handling
- ‚úÖ Th√™m validation ObjectID
- ‚úÖ Th√¥ng b√°o l·ªói r√µ r√†ng cho user
- ‚úÖ Logging chi ti·∫øt ƒë·ªÉ debug

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: Gallery Images b·ªã m·∫•t

### ‚ùå V·∫•n ƒë·ªÅ

- Sau khi c·∫≠p nh·∫≠t variant (stock, price), `galleryImages` b·ªã set th√†nh array r·ªóng
- Database shows: `galleryImages: Array (empty)`
- ·∫¢nh b·ªã m·∫•t ho√†n to√†n

### üîç Nguy√™n nh√¢n

1. **ExpandableVariant.tsx**: `editData.imageFiles || editData.galleryImages`

   - `imageFiles` ƒë∆∞·ª£c init th√†nh `[]` (empty array)
   - Logic `||` tr·∫£ v·ªÅ `[]` thay v√¨ preserve existing `galleryImages`

2. **API Route**: `galleryImages: galleryImages || []`
   - Khi `galleryImages` l√† `undefined`, set th√†nh `[]`
   - Kh√¥ng preserve existing data

### ‚úÖ Gi·∫£i ph√°p

#### 1. S·ª≠a ExpandableVariant.tsx

```typescript
// Tr∆∞·ªõc
galleryImages: editData.imageFiles || editData.galleryImages;

// Sau
galleryImages: editData.imageFiles && editData.imageFiles.length > 0 ? editData.imageFiles : editData.galleryImages;
```

#### 2. S·ª≠a API Route

```typescript
// Tr∆∞·ªõc
galleryImages: galleryImages || [],

// Sau
if (galleryImages !== undefined) updateData.galleryImages = galleryImages;
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ Preserve existing galleryImages khi ch·ªâ update stock/price
- ‚úÖ Ch·ªâ update galleryImages khi c√≥ ·∫£nh m·ªõi
- ‚úÖ Th√™m logging ƒë·ªÉ debug

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: Prisma Validation Error

### ‚ùå V·∫•n ƒë·ªÅ

- Error: `Invalid value provided. Expected ProductVariantUpdategalleryImagesInput or String, provided Object`
- `galleryImages` ƒë∆∞·ª£c g·ª≠i d∆∞·ªõi d·∫°ng object array thay v√¨ string array
- Schema Prisma y√™u c·∫ßu `String[]` nh∆∞ng nh·∫≠n ƒë∆∞·ª£c `[{path: "..."}, ...]`

### üîç Nguy√™n nh√¢n

1. **File objects ƒë∆∞·ª£c g·ª≠i tr·ª±c ti·∫øp**: `editData.imageFiles` ch·ª©a File objects
2. **JSON.stringify File objects**: T·∫°o ra object format thay v√¨ URLs
3. **Thi·∫øu Firebase upload**: Kh√¥ng upload ·∫£nh l√™n Firebase tr∆∞·ªõc khi g·ª≠i API

### ‚úÖ Gi·∫£i ph√°p

#### 1. Th√™m Firebase Upload trong ExpandableVariant

```typescript
// Import Firebase utilities
import { uploadVariantProductThumbnail, uploadVariantProductGallery } from '@/app/utils/firebase-product-storage';

// Upload function
const uploadImagesToFirebase = async (productName: string, variantId: string) => {
  // Upload thumbnail v√† gallery images
  // Return URLs thay v√¨ File objects
};
```

#### 2. C·∫≠p nh·∫≠t handleSave logic

```typescript
// Check for new images
const hasNewThumbnail = editData.thumbnailFile instanceof File;
const hasNewGalleryImages = editData.imageFiles && editData.imageFiles.some(file => file instanceof File);

// Upload to Firebase if needed
if (hasNewThumbnail || hasNewGalleryImages) {
  const uploadedImages = await uploadImagesToFirebase(productName, variantId);
  thumbnailToSend = uploadedImages.thumbnail;
  galleryImagesToSend = uploadedImages.galleryImages;
}
```

#### 3. Validate data types

```typescript
// Ensure only string URLs are sent to API
galleryImages: galleryImagesToSend; // Array of strings, not File objects
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ Upload ·∫£nh l√™n Firebase tr∆∞·ªõc khi g·ª≠i API
- ‚úÖ G·ª≠i URLs thay v√¨ File objects
- ‚úÖ Tu√¢n th·ªß Prisma schema requirements
- ‚úÖ Proper error handling cho Firebase upload

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: Logic CREATE vs EDIT Mode

### ‚ùå V·∫•n ƒë·ªÅ

- N√∫t "L∆∞u thay ƒë·ªïi" lu√¥n call API ngay c·∫£ khi variant ch∆∞a c√≥ trong database
- CREATE mode (variant m·ªõi): Kh√¥ng n√™n call API, ch·ªâ update local state
- EDIT mode (variant ƒë√£ c√≥): C·∫ßn call API ƒë·ªÉ update database
- User kh√¥ng hi·ªÉu r√µ s·ª± kh√°c bi·ªát gi·ªØa 2 modes

### üîç Nguy√™n nh√¢n

1. **Kh√¥ng ph√¢n bi·ªát CREATE vs EDIT**: Logic c≈© lu√¥n c·ªë g·∫Øng call API
2. **Thi·∫øu validation mode**: Kh√¥ng check `databaseId` ƒë·ªÉ x√°c ƒë·ªãnh mode
3. **UX kh√¥ng r√µ r√†ng**: User kh√¥ng bi·∫øt khi n√†o call API, khi n√†o ch·ªâ update local

### ‚úÖ Gi·∫£i ph√°p

#### 1. Ph√¢n bi·ªát CREATE vs EDIT Mode

```typescript
const variantId = variant.databaseId;
const isEditMode = variantId && /^[0-9a-fA-F]{24}$/.test(variantId);

if (!isEditMode) {
  // CREATE MODE: Just update local state, don't call API
  onUpdate(variant.id, editData);
  return;
}

// EDIT MODE: Call API to update existing variant
```

#### 2. C·∫£i thi·ªán UX v·ªõi th√¥ng b√°o r√µ r√†ng

```typescript
// Info box hi·ªÉn th·ªã mode hi·ªán t·∫°i
{variant.databaseId && /^[0-9a-fA-F]{24}$/.test(variant.databaseId) ? (
  <strong>Ch·∫ø ƒë·ªô ch·ªânh s·ª≠a:</strong> Thay ƒë·ªïi s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t tr·ª±c ti·∫øp v√†o database
) : (
  <strong>Ch·∫ø ƒë·ªô t·∫°o m·ªõi:</strong> Thay ƒë·ªïi s·∫Ω ƒë∆∞·ª£c l∆∞u t·∫°m th·ªùi, c·∫ßn submit form ch√≠nh ƒë·ªÉ l∆∞u v√†o database
)}
```

#### 3. Logging ƒë·ªÉ debug

```typescript
console.log('üîÑ Save mode:', {
  mode: isEditMode ? 'EDIT' : 'CREATE',
  variantId,
  hasValidObjectId: isEditMode
});
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ CREATE mode: Ch·ªâ update local state, kh√¥ng call API
- ‚úÖ EDIT mode: Call API ƒë·ªÉ update database
- ‚úÖ UX r√µ r√†ng v·ªõi info box gi·∫£i th√≠ch mode
- ‚úÖ Logging chi ti·∫øt ƒë·ªÉ debug

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: Category Selection b·ªã ·∫©n

### ‚ùå V·∫•n ƒë·ªÅ

- Khi ch·ªçn "S·∫£n ph·∫©m bi·∫øn th·ªÉ", section "Ph√¢n lo·∫°i" (category selection) b·ªã ·∫©n
- G√¢y l·ªói 400 Bad Request khi t·∫°o s·∫£n ph·∫©m v√¨ thi·∫øu `categoryId`
- User kh√¥ng th·ªÉ ch·ªçn danh m·ª•c cho variant products

### üîç Nguy√™n nh√¢n

- Section "Ph√¢n lo·∫°i" n·∫±m trong Right Column (ch·ªâ hi·ªÉn th·ªã cho SIMPLE products)
- Khi ch·ªçn VARIANT product, Right Column b·ªã ·∫©n ‚Üí Category selection c≈©ng b·ªã ·∫©n
- Logic: `{productType === ProductType.SIMPLE && (Right Column)}`

### ‚úÖ Gi·∫£i ph√°p

#### 1. Di chuy·ªÉn Category Selection ra kh·ªèi Right Column

```typescript
// Tr∆∞·ªõc: N·∫±m trong Right Column (ch·ªâ cho SIMPLE)
{
  productType === ProductType.SIMPLE && (
    <Grid item xs={12} md={6}>
      {/* Category selection ·ªü ƒë√¢y */}
    </Grid>
  );
}

// Sau: N·∫±m trong Left Column (cho c·∫£ SIMPLE v√† VARIANT)
<Grid item xs={12} md={productType === ProductType.SIMPLE ? 6 : 12}>
  {/* Product info */}
  {/* Category selection - Always visible */}
</Grid>;
```

#### 2. C·∫≠p nh·∫≠t comment v√† structure

```typescript
{
  /* Organize Section - Always visible for both product types */
}
<Card sx={{ p: 3, borderRadius: '12px', border: '1px solid #e5e7eb', mt: 3 }}>
  <Typography variant='h6'>Ph√¢n lo·∫°i</Typography>
  {/* Category selection fields */}
</Card>;
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ Category selection lu√¥n hi·ªÉn th·ªã cho c·∫£ SIMPLE v√† VARIANT products
- ‚úÖ Kh√¥ng c√≤n l·ªói 400 Bad Request khi t·∫°o variant products
- ‚úÖ UX nh·∫•t qu√°n cho c·∫£ 2 lo·∫°i s·∫£n ph·∫©m
- ‚úÖ Validation `categoryId` ho·∫°t ƒë·ªông ƒë√∫ng

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: API Validation Error

### ‚ùå V·∫•n ƒë·ªÅ

- API b√°o "Missing required fields" khi t·∫°o variant products
- Error message kh√¥ng c·ª• th·ªÉ, kh√≥ debug
- Frontend g·ª≠i sai field name (`price` thay v√¨ `basePrice`)

### üîç Nguy√™n nh√¢n

1. **API y√™u c·∫ßu**: `name`, `description`, `basePrice`, `categoryId`
2. **Frontend g·ª≠i**: `price = 0` thay v√¨ `basePrice = 0`
3. **Error message chung chung**: "Missing required fields"

### ‚úÖ Gi·∫£i ph√°p

#### 1. C·∫£i thi·ªán API Error Messages

```typescript
// API: Detailed validation with specific error messages
const missingFields = [];
if (!name) missingFields.push('name (t√™n s·∫£n ph·∫©m)');
if (!description) missingFields.push('description (m√¥ t·∫£)');
if (!basePrice) missingFields.push('basePrice (gi√° c∆° b·∫£n)');
if (!categoryId) missingFields.push('categoryId (danh m·ª•c)');

return NextResponse.json(
  {
    error: `Thi·∫øu c√°c tr∆∞·ªùng b·∫Øt bu·ªôc: ${missingFields.join(', ')}`,
    missingFields,
    receivedData: { name, description, basePrice, categoryId }
  },
  { status: 400 }
);
```

#### 2. S·ª≠a Frontend Data Mapping

```typescript
// Tr∆∞·ªõc: G·ª≠i sai field
submitData.price = 0;
submitData.basePrice = 0;

// Sau: Ch·ªâ g·ª≠i field API c·∫ßn
submitData.basePrice = 0; // API expects basePrice (not price)
```

#### 3. C·∫£i thi·ªán Frontend Error Handling

```typescript
catch (error: any) {
  let errorMessage = 'C√≥ l·ªói x·∫£y ra khi t·∫°o s·∫£n ph·∫©m';

  if (error?.response?.data?.error) {
    errorMessage = error.response.data.error; // Show specific API error
  }

  toast.error(errorMessage);
}
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ API error messages c·ª• th·ªÉ v√† r√µ r√†ng
- ‚úÖ Frontend g·ª≠i ƒë√∫ng field names
- ‚úÖ Error handling hi·ªÉn th·ªã l·ªói t·ª´ API
- ‚úÖ Logging chi ti·∫øt ƒë·ªÉ debug

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: basePrice kh√¥ng c·∫ßn thi·∫øt

### ‚ùå V·∫•n ƒë·ªÅ

- API y√™u c·∫ßu `basePrice` b·∫Øt bu·ªôc cho variant products
- Nh∆∞ng trong schema, `ProductVariant` ƒë√£ c√≥ field `price` ri√™ng
- `basePrice` ·ªü Product level kh√¥ng c·∫ßn thi·∫øt v√¨ m·ªói variant c√≥ gi√° ri√™ng

### üîç Nguy√™n nh√¢n

- Schema: `Product.basePrice` l√† optional (`Float?`)
- Logic: Variant products n√™n t√≠nh `basePrice` t·ª´ gi√° th·∫•p nh·∫•t c·ªßa variants
- API validation: ƒêang y√™u c·∫ßu `basePrice` b·∫Øt bu·ªôc

### ‚úÖ Gi·∫£i ph√°p

#### 1. S·ª≠a API Validation

```typescript
// Tr∆∞·ªõc: Y√™u c·∫ßu basePrice b·∫Øt bu·ªôc
if (!basePrice) missingFields.push('basePrice (gi√° c∆° b·∫£n)');

// Sau: basePrice optional, s·∫Ω t√≠nh t·ª´ variants
const basePrice = 0; // Optional for variant products, will be calculated from variants
```

#### 2. T√≠nh basePrice t·ª´ variants

```typescript
// Track min price for basePrice calculation
let minPrice = null;
for (const variant of variants) {
  const variantPrice = parseFloat(variant.price);
  if (minPrice === null || variantPrice < minPrice) {
    minPrice = variantPrice;
  }
}

// Update product with calculated basePrice
await tx.product.update({
  where: { id: product.id },
  data: {
    basePrice: minPrice, // Set basePrice to minimum variant price
    inStock: totalStock // Set total stock from all variants
  }
});
```

#### 3. Frontend kh√¥ng g·ª≠i basePrice

```typescript
// Tr∆∞·ªõc: G·ª≠i basePrice = 0
submitData.basePrice = 0;

// Sau: Kh√¥ng g·ª≠i, ƒë·ªÉ API t·ª± t√≠nh
// basePrice will be calculated from variants on the server side
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ API kh√¥ng y√™u c·∫ßu basePrice b·∫Øt bu·ªôc
- ‚úÖ basePrice ƒë∆∞·ª£c t√≠nh t·ª± ƒë·ªông t·ª´ gi√° th·∫•p nh·∫•t c·ªßa variants
- ‚úÖ inStock ƒë∆∞·ª£c t√≠nh t·ª± ƒë·ªông t·ª´ t·ªïng stock c·ªßa variants
- ‚úÖ Logic ph√π h·ª£p v·ªõi business requirements

## V·∫•n ƒë·ªÅ ph√°t hi·ªán th√™m: Simple Product API c≈©ng c·∫ßn c·∫£i thi·ªán

### ‚ùå V·∫•n ƒë·ªÅ

- Simple product APIs (`/api/product` POST v√† PUT) c≈©ng c√≥ error messages chung chung
- Kh√¥ng c√≥ validation c·ª• th·ªÉ cho t·ª´ng field
- Kh√≥ debug khi c√≥ l·ªói

### ‚úÖ Gi·∫£i ph√°p

#### 1. C·∫£i thi·ªán POST `/api/product`

```typescript
// Detailed validation with specific error messages
const missingFields = [];

// Common required fields for all product types
if (!name || name.trim() === '') missingFields.push('name (t√™n s·∫£n ph·∫©m)');
if (!description || description.trim() === '') missingFields.push('description (m√¥ t·∫£)');
if (!categoryId || categoryId.trim() === '') missingFields.push('categoryId (danh m·ª•c)');

// Simple product specific validation
if (productType === 'SIMPLE') {
  const simpleProductErrors = [];

  if (!price || price <= 0) {
    simpleProductErrors.push('price (gi√° s·∫£n ph·∫©m > 0)');
  }
  if (inStock === undefined || inStock === null || inStock < 0) {
    simpleProductErrors.push('inStock (s·ªë l∆∞·ª£ng t·ªìn kho >= 0)');
  }
}
```

#### 2. C·∫£i thi·ªán PUT `/api/product/[id]`

```typescript
// Additional validation based on product type
if (productType === 'SIMPLE') {
  const simpleProductErrors = [];

  if (!price || price <= 0) {
    simpleProductErrors.push('price (gi√° s·∫£n ph·∫©m > 0)');
  }
  if (inStock === undefined || inStock === null || inStock < 0) {
    simpleProductErrors.push('inStock (s·ªë l∆∞·ª£ng t·ªìn kho >= 0)');
  }

  if (simpleProductErrors.length > 0) {
    return NextResponse.json(
      {
        error: `S·∫£n ph·∫©m ƒë∆°n thi·∫øu: ${simpleProductErrors.join(', ')}`,
        missingFields: simpleProductErrors,
        receivedData: { price, inStock }
      },
      { status: 400 }
    );
  }
}
```

#### 3. C·∫£i thi·ªán Variant Validation

```typescript
// Validate each variation
const variantErrors = [];
for (let i = 0; i < variations.length; i++) {
  const variation = variations[i];
  if (!variation.price || variation.price <= 0) {
    variantErrors.push(`Bi·∫øn th·ªÉ ${i + 1}: thi·∫øu gi√° h·ª£p l·ªá (> 0)`);
  }
  if (variation.stock === undefined || variation.stock === null || variation.stock < 0) {
    variantErrors.push(`Bi·∫øn th·ªÉ ${i + 1}: thi·∫øu s·ªë l∆∞·ª£ng h·ª£p l·ªá (>= 0)`);
  }
}
```

### ‚úÖ K·∫øt qu·∫£

- ‚úÖ T·∫•t c·∫£ APIs c√≥ error messages c·ª• th·ªÉ v√† r√µ r√†ng
- ‚úÖ Validation nh·∫•t qu√°n gi·ªØa POST v√† PUT
- ‚úÖ Logging chi ti·∫øt ƒë·ªÉ debug
- ‚úÖ Error handling t·ªët cho c·∫£ simple v√† variant products

## Next Steps

1. ‚úÖ Test preserve galleryImages khi update stock
2. ‚úÖ Test upload ·∫£nh m·ªõi cho variant v·ªõi Firebase
3. ‚úÖ Test CREATE mode (variant m·ªõi) - ch·ªâ update local state
4. ‚úÖ Test EDIT mode (variant ƒë√£ c√≥) - call API update
5. ‚úÖ Test category selection cho variant products
6. ‚úÖ Test API validation v√† error messages
7. ‚úÖ Test basePrice calculation t·ª´ variants
8. ‚úÖ Test simple product API validation
9. Test drag & drop reorder images
10. Ki·ªÉm tra performance v·ªõi nhi·ªÅu variants
